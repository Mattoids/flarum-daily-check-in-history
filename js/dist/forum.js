/*! For license information please see forum.js.LICENSE.txt */
(()=>{var t={24:(t,e,n)=>{var r=n(163),o=n(110),a=n(996),i=n(312),s=n(166),u=n(766),c=n(760);function l(){"use strict";var e=o(),n=e.m(l),d=(Object.getPrototypeOf?Object.getPrototypeOf(n):n.__proto__).constructor;function f(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===d||"GeneratorFunction"===(e.displayName||e.name))}var p={throw:1,return:2,break:3,continue:3};function m(t){var e,n;return function(r){e||(e={stop:function(){return n(r.a,2)},catch:function(){return r.v},abrupt:function(t,e){return n(r.a,p[t],e)},delegateYield:function(t,o,a){return e.resultName=o,n(r.d,c(t),a)},finish:function(t){return n(r.f,t)}},n=function(t,n,o){r.p=e.prev,r.n=e.next;try{return t(n,o)}finally{e.next=r.n}}),e.resultName&&(e[e.resultName]=r.v,e.resultName=void 0),e.sent=r.v,e.next=r.n;try{return t.call(this,e)}finally{r.p=e.prev,r.n=e.next}}}return(t.exports=l=function(){return{wrap:function(t,n,r,o){return e.w(m(t),n,r,o&&o.reverse())},isGeneratorFunction:f,mark:e.m,awrap:function(t,e){return new r(t,e)},AsyncIterator:s,async:function(t,e,n,r,o){return(f(e)?i:a)(m(t),e,n,r,o)},keys:u,values:c}},t.exports.__esModule=!0,t.exports.default=t.exports)()}t.exports=l,t.exports.__esModule=!0,t.exports.default=t.exports},110:(t,e,n)=>{var r=n(397);function o(){var e,n,a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",s=a.toStringTag||"@@toStringTag";function u(t,o,a,i){var s=o&&o.prototype instanceof l?o:l,u=Object.create(s.prototype);return r(u,"_invoke",function(t,r,o){var a,i,s,u=0,l=o||[],d=!1,f={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,n){return a=t,i=0,s=e,f.n=n,c}};function p(t,r){for(i=t,s=r,n=0;!d&&u&&!o&&n<l.length;n++){var o,a=l[n],p=f.p,m=a[2];t>3?(o=m===r)&&(s=a[(i=a[4])?5:(i=3,3)],a[4]=a[5]=e):a[0]<=p&&((o=t<2&&p<a[1])?(i=0,f.v=r,f.n=a[1]):p<m&&(o=t<3||a[0]>r||r>m)&&(a[4]=t,a[5]=r,f.n=m,i=0))}if(o||t>1)return c;throw d=!0,r}return function(o,l,m){if(u>1)throw TypeError("Generator is already running");for(d&&1===l&&p(l,m),i=l,s=m;(n=i<2?e:s)||!d;){a||(i?i<3?(i>1&&(f.n=-1),p(i,s)):f.n=s:f.v=s);try{if(u=2,a){if(i||(o="next"),n=a[o]){if(!(n=n.call(a,s)))throw TypeError("iterator result is not an object");if(!n.done)return n;s=n.value,i<2&&(i=0)}else 1===i&&(n=a.return)&&n.call(a),i<2&&(s=TypeError("The iterator does not provide a '"+o+"' method"),i=1);a=e}else if((n=(d=f.n<0)?s:t.call(r,f))!==c)break}catch(t){a=e,i=1,s=t}finally{u=1}}return{value:n,done:d}}}(t,a,i),!0),u}var c={};function l(){}function d(){}function f(){}n=Object.getPrototypeOf;var p=[][i]?n(n([][i]())):(r(n={},i,(function(){return this})),n),m=f.prototype=l.prototype=Object.create(p);function h(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,f):(t.__proto__=f,r(t,s,"GeneratorFunction")),t.prototype=Object.create(m),t}return d.prototype=f,r(m,"constructor",f),r(f,"constructor",d),d.displayName="GeneratorFunction",r(f,s,"GeneratorFunction"),r(m),r(m,s,"Generator"),r(m,i,(function(){return this})),r(m,"toString",(function(){return"[object Generator]"})),(t.exports=o=function(){return{w:u,m:h}},t.exports.__esModule=!0,t.exports.default=t.exports)()}t.exports=o,t.exports.__esModule=!0,t.exports.default=t.exports},163:t=>{t.exports=function(t,e){this.v=t,this.k=e},t.exports.__esModule=!0,t.exports.default=t.exports},166:(t,e,n)=>{var r=n(163),o=n(397);t.exports=function t(e,n){function a(t,o,i,s){try{var u=e[t](o),c=u.value;return c instanceof r?n.resolve(c.v).then((function(t){a("next",t,i,s)}),(function(t){a("throw",t,i,s)})):n.resolve(c).then((function(t){u.value=t,i(u)}),(function(t){return a("throw",t,i,s)}))}catch(t){s(t)}}var i;this.next||(o(t.prototype),o(t.prototype,"function"==typeof Symbol&&Symbol.asyncIterator||"@asyncIterator",(function(){return this}))),o(this,"_invoke",(function(t,e,r){function o(){return new n((function(e,n){a(t,r,e,n)}))}return i=i?i.then(o,o):o()}),!0)},t.exports.__esModule=!0,t.exports.default=t.exports},183:(t,e,n)=>{var r=n(24)();t.exports=r;try{regeneratorRuntime=r}catch(t){"object"==typeof globalThis?globalThis.regeneratorRuntime=r:Function("r","regeneratorRuntime = r")(r)}},312:(t,e,n)=>{var r=n(110),o=n(166);t.exports=function(t,e,n,a,i){return new o(r().w(t,e,n,a),i||Promise)},t.exports.__esModule=!0,t.exports.default=t.exports},397:t=>{function e(n,r,o,a){var i=Object.defineProperty;try{i({},"",{})}catch(n){i=0}t.exports=e=function(t,n,r,o){if(n)i?i(t,n,{value:r,enumerable:!o,configurable:!o,writable:!o}):t[n]=r;else{var a=function(n,r){e(t,n,(function(t){return this._invoke(n,r,t)}))};a("next",0),a("throw",1),a("return",2)}},t.exports.__esModule=!0,t.exports.default=t.exports,e(n,r,o,a)}t.exports=e,t.exports.__esModule=!0,t.exports.default=t.exports},735:t=>{function e(n){return t.exports=e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t.exports.__esModule=!0,t.exports.default=t.exports,e(n)}t.exports=e,t.exports.__esModule=!0,t.exports.default=t.exports},760:(t,e,n)=>{var r=n(735).default;t.exports=function(t){if(null!=t){var e=t["function"==typeof Symbol&&Symbol.iterator||"@@iterator"],n=0;if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length))return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}}}throw new TypeError(r(t)+" is not iterable")},t.exports.__esModule=!0,t.exports.default=t.exports},766:t=>{t.exports=function(t){var e=Object(t),n=[];for(var r in e)n.unshift(r);return function t(){for(;n.length;)if((r=n.pop())in e)return t.value=r,t.done=!1,t;return t.done=!0,t}},t.exports.__esModule=!0,t.exports.default=t.exports},996:(t,e,n)=>{var r=n(312);t.exports=function(t,e,n,o,a){var i=r(t,e,n,o,a);return i.next().then((function(t){return t.done?t.value:i.next()}))},t.exports.__esModule=!0,t.exports.default=t.exports}},e={};function n(r){var o=e[r];if(void 0!==o)return o.exports;var a=e[r]={exports:{}};return t[r](a,a.exports,n),a.exports}n.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return n.d(e,{a:e}),e},n.d=(t,e)=>{for(var r in e)n.o(e,r)&&!n.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{"use strict";const t=flarum.core.compat["forum/app"];var e=n.n(t);const r=flarum.core.compat["common/extend"],o=flarum.core.compat["forum/components/UserPage"];var a=n.n(o);const i=flarum.core.compat["components/UserCard"];var s=n.n(i);const u=flarum.core.compat["common/components/LinkButton"];var c=n.n(u);function l(t,e,n,r,o,a,i){try{var s=t[a](i),u=s.value}catch(t){return void n(t)}s.done?e(u):Promise.resolve(u).then(r,o)}function d(t){return function(){var e=this,n=arguments;return new Promise((function(r,o){var a=t.apply(e,n);function i(t){l(a,r,o,i,s,"next",t)}function s(t){l(a,r,o,i,s,"throw",t)}i(void 0)}))}}function f(t,e){return f=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},f(t,e)}function p(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,f(t,e)}var h=n(183),y=n.n(h);function v(){return v=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)({}).hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},v.apply(null,arguments)}var x={fullcalendarCore:{js:"/assets/extensions/mattoid-daily-check-in-history/dist/@fullcalendar/core@6.1.8/index.global.min.js",loaded:function(){return"undefined"!=typeof FullCalendar}},fullcalendarLocales:{js:"/assets/extensions/mattoid-daily-check-in-history/dist/@fullcalendar/core@6.1.8/locales-all.global.min.js",loaded:function(){return"undefined"!=typeof FullCalendar&&FullCalendar.globalLocales.length>2}},fullcalendarDayGrid:{js:"/assets/extensions/mattoid-daily-check-in-history/dist/@fullcalendar/daygrid@6.1.8/index.global.min.js",loaded:function(){return"undefined"!=typeof FullCalendar&&FullCalendar.globalPlugins.find((function(t){return"@fullcalendar/daygrid"===t.name}))}},fullcalendarInteraction:{js:"/assets/extensions/mattoid-daily-check-in-history/dist/@fullcalendar/interaction@6.1.8/index.global.min.js",loaded:function(){return"undefined"!=typeof FullCalendar&&FullCalendar.globalPlugins.find((function(t){return"@fullcalendar/interaction"===t.name}))}},fullcalendarList:{js:"/assets/extensions/mattoid-daily-check-in-history/dist/@fullcalendar/list@6.1.8/index.global.min.js",loaded:function(){return"undefined"!=typeof FullCalendar&&FullCalendar.globalPlugins.find((function(t){return"@fullcalendar/list"===t.name}))}},flatpickr:{css:"/assets/extensions/mattoid-daily-check-in-history/dist/@fullcalendar/flatpickr.min.css",js:"https://cdn.jsdelivr.net/npm/flatpickr",loaded:function(){return void 0!==window.flatpickr}},flatpickrLocale:{js:function(t){return"https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/"+t+".js"},loaded:function(t){return void 0!==window.flatpickr.l10ns[t]}}};function b(t){for(var e,n=arguments.length,r=new Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];if(Array.isArray(t))return Promise.all(t.map((function(t){return b(t)})));var a={};if("object"==typeof t&&!(a=v({},t)).loaded)return console.warn("dynamicallyLoadLib: No loaded function defined for lib",t),Promise.resolve();if("string"==typeof t){if(!x[t])return console.warn("dynamicallyLoadLib: lib not found",t),Promise.resolve();a=v({},x[t])}if(0===Object.keys(a).length)return console.warn("dynamicallyLoadLib: lib is not a string nor an valid object",t),Promise.resolve();var i=[];if((e=a).loaded.apply(e,r))i.push(Promise.resolve());else{var s;if(a.css&&(Array.isArray(a.css)?a.css:[a.css]).forEach((function(t){var e=document.createElement("link");e.rel="stylesheet",e.href=t,document.head.appendChild(e)})),a.js)"function"==typeof a.js&&(a.js=(s=a).js.apply(s,r)),(Array.isArray(a.js)?a.js:[a.js]).forEach((function(t){var e=document.createElement("script");e.src=t,document.head.appendChild(e)}));i.push(new Promise((function(t,e){var n=setInterval((function(){var e;(e=a).loaded.apply(e,r)&&(clearInterval(n),t())}),5)})))}return Promise.all(i)}const g=flarum.core.compat["common/components/Modal"];var k=n.n(g);flarum.core.compat["common/components/Alert"];const j=flarum.core.compat["common/components/Button"];var _=n.n(j),w=function(t){function n(){return t.apply(this,arguments)||this}p(n,t);var r=n.prototype;return r.oninit=function(e){t.prototype.oninit.call(this,e)},r.title=function(){return e().translator.trans("mattoid-daily-check-in-history.forum.modal.checkin")},r.className=function(){return"SupplementCheckinModal Modal--large"},r.content=function(){return[m("div",{className:"Modal-body",style:"text-align: center;"},m("div",{className:"Form-group"},m("label",{className:"label"},e().translator.trans("mattoid-daily-check-in-history.forum.modal.supplement-checkin-desc",{dateStr:this.attrs.info.dateStr}))),m("div",{className:"Form-group"},m(_(),{type:"submit",className:"Button Button--primary PollModal-SubmitButton",loading:this.loading},e().translator.trans("mattoid-daily-check-in-history.forum.modal.submit"))))]},r.onsubmit=function(){var t=d(y().mark((function t(n){return y().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n.preventDefault(),e().request({method:"POST",url:e().forum.attribute("apiUrl")+"/supplement/checkin",body:{date:this.attrs.info.dateStr}}).then((function(t){console.log(t)})),this.attrs.callback(),this.hide();case 1:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}(),n}(k()),O=function(t){function e(){return t.apply(this,arguments)||this}p(e,t);var n=e.prototype;return n.oninit=function(e){t.prototype.oninit.call(this,e),this.loadUser(m.route.param("username"))},n.content=function(){if(app.session.user)return m("div",{className:"CheckinHistoryUserPage"},m("div",{id:"calendar"}),this.loading&&m("div",{class:"DiscussionList"},m("div",{class:"DiscussionList-loadMore"},m("div",{"aria-label":"loading…",role:"status","data-size":"medium",class:"LoadingIndicator-container LoadingIndicator-container--block LoadingIndicator-container--medium"},m("div",{"aria-hidden":"true",class:"LoadingIndicator"})))))},n.oncreate=function(t){this.renderCalendar(t)},n.onupdate=function(){},n.onbeforeremove=function(){},n.onremove=function(){},n.onbeforeupdate=function(){},n.getData=function(){var t=d(y().mark((function t(e,n,r){var o=this;return y().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.loading=!0,t.next=1,app.store.find("checkin/history",{start:e.start.toISOString(),end:e.end.toISOString(),username:this.user.slug(),userId:this.user.id()});case 1:return this.history=t.sent,t.abrupt("return",this.history.payload.data.map((function(t){return o.loading=!1,t.attributes})));case 2:case"end":return t.stop()}}),t,this)})));return function(e,n,r){return t.apply(this,arguments)}}(),n.renderCalendar=function(){var t=d(y().mark((function t(e){var n,r,o=this;return y().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=1,b("fullcalendarCore");case 1:return t.next=2,b(["fullcalendarLocales","fullcalendarDayGrid","fullcalendarInteraction","fullcalendarList"]);case 2:return n=document.getElementById("calendar"),t.next=3,this.openCreateModal.bind(this);case 3:r=t.sent,this.calendar=new FullCalendar.Calendar(n,{locale:app.translator.getLocale(),allDayText:"今天",initialView:"dayGridMonth",dateClick:function(t){r(t)},events:function(t,e,n){return o.getData(t,e,n)}}),this.calendar.render();case 4:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}(),n.openCreateModal=function(){var t=d(y().mark((function t(e){var n,r,o,a,i=this;return y().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.calendar.refetchEvents.bind(this.calendar),!(new Date(e.dateStr).getTime()>new Date)){t.next=1;break}return t.abrupt("return",!1);case 1:n=this.history.payload.data,o=y().keys(n);case 2:if((a=o()).done){t.next=4;break}if(r=a.value,n[r].attributes.start!=e.dateStr){t.next=3;break}return t.abrupt("return",!1);case 3:t.next=2;break;case 4:app.modal.show(w,{info:e,callback:function(){i.getData(i.calendar.currentData.dateProfile.activeRange,null,null),i.calendar.refetchEvents()}});case 5:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}(),e}(a());e().initializers.add("mattoid-checkin-history",(function(){e().routes["user.checkin.history"]={path:"/u/:username/checkin/history",component:O},(0,r.extend)(s().prototype,"infoItems",(function(t){t.add("checkinCard",m("span",null,e().translator.trans("mattoid-daily-check-in-history.forum.page.checkin-card")+"："+this.attrs.user.data.attributes.checkinCard))})),(0,r.extend)(a().prototype,"navItems",(function(t){(e().session.user.id()===this.user.id()||this.user&&this.user.attribute("canQueryOthersHistory"))&&t.add("post-checkin-history",c().component({href:e().route("user.checkin.history",{username:this.user.slug()}),icon:"fas fa-calendar-alt"},e().translator.trans("mattoid-daily-check-in-history.forum.page.link-name")))}))}))})(),module.exports={}})();
//# sourceMappingURL=forum.js.map